<!DOCTYPE html>
<html>
  <head>
    <title>Exemplo de página web com vídeo</title>
    <style>
      body {
        margin: 0;
        padding: 0;
      }

      #video-container {
        width: 100vw;
        height: 50vh;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: black;
      }

      #camera-container {
        width: 100vw;
        height: 50vh;
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: grey;
      }
    </style>
  </head>
  <body>
    <div id="video-container">
      <video id="myVideo" width="560" height="315">
        <source
          src="https://www.youtube.com/watch?v=6ISYNFHejPw&ab_channel=CESARMC"
          type="video/mp4"
        />
      </video>
      <button onclick="openFullscreen()">Tela cheia</button>
    </div>

    <div id="camera-container"></div>

    <script>
      function openFullscreen() {
        var elem = document.getElementById("myVideo");
        if (elem.requestFullscreen) {
          elem.requestFullscreen();
        } else if (elem.mozRequestFullScreen) {
          /* Firefox */
          elem.mozRequestFullScreen();
        } else if (elem.webkitRequestFullscreen) {
          /* Chrome, Safari and Opera */
          elem.webkitRequestFullscreen();
        } else if (elem.msRequestFullscreen) {
          /* IE/Edge */
          elem.msRequestFullscreen();
        }
      }

      function playVideo() {
        var video = document.getElementById("myVideo");
        video.play();
      }

      function pauseVideo() {
        var video = document.getElementById("myVideo");
        video.pause();
      }

      var video = document.getElementById("myVideo");
      var lastScannedCode = null;

      function detectQRCode() {
        navigator.mediaDevices
          .getUserMedia({ video: { facingMode: "environment" } })
          .then(function (stream) {
            var videoElement = document.createElement("video");
            videoElement.srcObject = stream;
            videoElement.setAttribute("playsinline", true);
            videoElement.play();
            var cameraContainer = document.getElementById("camera-container");
            cameraContainer.appendChild(videoElement);
            setTimeout(() => {
              var canvas = document.createElement("canvas");
              var context = canvas.getContext("2d");
              canvas.width = videoElement.videoWidth;
              canvas.height = videoElement.videoHeight;
              context.drawImage(videoElement, 0, 0, canvas.width, canvas.height);
              try {
                qrcode.decode();
              } catch (e) {
                setTimeout(detectQRCode, 500);
              }
            }, 1000);
          })
          .catch(function (err) {
            console.log("Error: " + err);
          });

        qrcode.callback = function (data) {
          if (data !== lastScannedCode) {
            lastScannedCode = data;
            if (data) {
              console.log("QR Code detected: " + data);
              playVideo();
            } else {
              console.log("QR Code removed from camera view");
              pauseVideo();
            }
          }
          setTimeout(detectQRCode, 500);
        };
      }

      detectQRCode();
    </script>
  </body>
</html>
