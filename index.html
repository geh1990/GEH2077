<!DOCTYPE html>
<html>
  <head>
    <title>Exemplo de página web com vídeo</title>
    <style>
      body {
        margin: 0;
        padding: 0;
      }

      .div {
        width: 100vw;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: flex-start;
      }
      .video-container {
        padding: 75% 0 0 0;
        position: relative;
      }

      /* oculta a câmera */
      #myVideo {
        display: none;
      }
    </style>
  </head>
  <body>
    <div class="div">
      <div class="video-container">
        <video id="qr-video" width="560" height="315"></video>
        <button onclick="openFullscreen()">Tela cheia</button>
      </div>
    </div>

    <script src="https://cdn.rawgit.com/LazarSoft/jsqrcode/master/src/qr_packed.js"></script>
    <script>
      function openFullscreen() {
        var elem = document.getElementById("qr-video");
        if (elem.requestFullscreen) {
          elem.requestFullscreen();
        } else if (elem.mozRequestFullScreen) {
          /* Firefox */
          elem.mozRequestFullScreen();
        } else if (elem.webkitRequestFullscreen) {
          /* Chrome, Safari and Opera */
          elem.webkitRequestFullscreen();
        } else if (elem.msRequestFullscreen) {
          /* IE/Edge */
          elem.msRequestFullscreen();
        }
      }

      function playVideo() {
        var video = document.getElementById("myVideo");
        video.play();
      }

      function pauseVideo() {
        var video = document.getElementById("myVideo");
        video.pause();
      }

      var video = document.getElementById("qr-video");
      var lastScannedCode = null;

      function detectQRCode() {
        navigator.mediaDevices
          .getUserMedia({ video: { facingMode: "environment" } })
          .then(function (stream) {
            video.srcObject = stream;
            video.setAttribute("playsinline", true);
            video.play();
            setTimeout(() => {
              var canvas = document.createElement("canvas");
              var context = canvas.getContext("2d");
              canvas.width = video.videoWidth;
              canvas.height = video.videoHeight;
              context.drawImage(video, 0, 0, canvas.width, canvas.height);
              try {
                qrcode.decode();
              } catch (e) {
                setTimeout(detectQRCode, 500);
              }
            }, 1000);
          })
          .catch(function (err) {
            console.log("Error: " + err);
          });

        qrcode.callback = function (data) {
          if (data !== lastScannedCode) {
            lastScannedCode = data;
            if (data) {
              console.log("QR Code detected: " + data);
              playVideo();
            } else {
              console.log("QR Code removed from camera view");
              pauseVideo();
            }
          }
          setTimeout(detectQRCode, 500);
        };
      }

      detectQRCode();
    </script>
  </body>
</html>
